<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vượt chướng ngại vật — Bản thử nghiệm</title>
  <style>
    :root{--accent:#0b79d0;--muted:#666}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;margin:0;background:#f6f8fb;color:#111}
    .wrap{max-width:920px;margin:28px auto;padding:22px;background:white;border-radius:12px;box-shadow:0 8px 30px rgba(20,30,50,.08)}
    h1{margin:0 0 8px;font-size:20px}
    p.lead{margin:0 0 18px;color:var(--muted)}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:18px}
    .panel{padding:14px;border-radius:10px;background:#fafbff;border:1px solid rgba(10,30,80,.04)}
    .questions{display:grid;gap:10px}
    .row{display:flex;gap:10px;align-items:center}
    .row input[type=text]{flex:1;padding:8px;border-radius:8px;border:1px solid #ddd}
    .row button{padding:8px 12px;border-radius:8px;border:0;background:var(--accent);color:white;cursor:pointer}
    .row button[disabled]{opacity:.5;background:#b5cbe6}
    .hint-stage{display:grid;grid-template-columns:repeat(2,1fr);gap:6px;margin-top:12px}
    .hint-piece{height:120px;border-radius:8px;overflow:hidden;background:linear-gradient(180deg,#e9f2ff,#f8fbff);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;}
    .hint-piece.revealed{background:none}
    .score{font-weight:700;font-size:18px;color:var(--accent)}
    .buzzer{display:flex;gap:8px;align-items:center;margin-top:12px}
    .buzzer input{padding:8px;border-radius:8px;border:1px solid #ddd}
    .log{margin-top:12px;background:#fff;padding:10px;border-radius:8px;border:1px dashed #eee;max-height:160px;overflow:auto}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .small{font-size:13px;color:var(--muted)}
    footer{margin-top:14px;color:var(--muted);font-size:13px}
    /* SVG styling */
    .imgwrap{display:flex;align-items:center;justify-content:center;height:100%;}
    svg{width:100%;height:auto;display:block}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Vượt chướng ngại vật — Bản thử nghiệm (HTML)</h1>
    <p class="lead">Phiên bản mini: có 4 hàng câu hỏi, mỗi hàng mở 1 mảnh gợi ý. Bấm "Chuông" để đoán từ khóa bất kỳ lúc nào.</p>

    <div class="grid">
      <div>
        <div class="panel">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:10px">
            <div>
              <div class="small">Điểm hiện tại</div>
              <div class="score" id="score">0</div>
            </div>
            <div style="text-align:right">
              <div class="small">Tình trạng</div>
              <div id="status">Chưa bắt đầu</div>
            </div>
          </div>

          <hr style="margin:12px 0;border:none;border-top:1px solid #eef2f8">

          <div class="questions" id="questions">
            <!-- rows generated by JS -->
          </div>

          <div class="buzzer">
            <input type="text" id="buzzerInput" placeholder="Gõ đáp án từ khóa...">
            <button id="buzzBtn">Chuông! (Đoán)</button>
            <button id="revealAllBtn" title="Hiển thị tất cả mảnh gợi ý">Hiện tất cả</button>
          </div>

          <div class="controls">
            <button id="resetBtn">Reset trò chơi</button>
            <button id="editBtn">Chỉnh câu (mở form)</button>
          </div>

          <div class="log" id="log"></div>
        </div>

        <footer>
          Các câu mẫu có thể sửa bằng nút "Chỉnh câu". Từ khóa hiện tại được cài sẵn — đoán đúng được +60 điểm.
        </footer>
      </div>

      <div>
        <div class="panel">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
            <div><strong>Chướng ngại vật — Gợi ý</strong><div class="small">Mỗi hàng mở 1 mảnh</div></div>
            <div class="small">Mảnh mở: <span id="piecesOpen">0/4</span></div>
          </div>

          <div style="margin-top:12px" class="imgwrap">
            <!-- SVG image with 4 clip rects. Each 'piece' is hidden until revealed -->
            <svg viewBox="0 0 600 360" preserveAspectRatio="xMidYMid meet" id="hintSVG">
              <!-- background sky -->
              <rect width="600" height="360" fill="#cfe9ff" />
              <!-- sun -->
              <circle cx="480" cy="60" r="34" fill="#ffe18a" />
              <!-- mountain drawing -->
              <g id="mountain">
                <path d="M40 300 L200 80 L320 240 L420 120 L560 300 Z" fill="#5b8bd7" stroke="#3b6fa8" stroke-width="3"/>
                <path d="M200 80 L260 140 L320 240 L320 180 L260 120 Z" fill="#8fb8e8"/>
                <rect x="0" y="260" width="600" height="100" fill="#7ac57a"/>
              </g>

              <!-- Overlay pieces (masked) - each piece shows the mountain beneath when 'revealed' class added -->
              <g id="overlay">
                <mask id="m1"><rect width="600" height="360" fill="white"/><rect x="0" y="0" width="300" height="180" fill="black"/></mask>
                <rect class="pieceRect" id="piece1" x="0" y="0" width="300" height="180" fill="#0b79d0" opacity="0.95"/>

                <mask id="m2"><rect width="600" height="360" fill="white"/><rect x="300" y="0" width="300" height="180" fill="black"/></mask>
                <rect class="pieceRect" id="piece2" x="300" y="0" width="300" height="180" fill="#0b79d0" opacity="0.95"/>

                <mask id="m3"><rect width="600" height="360" fill="white"/><rect x="0" y="180" width="300" height="180" fill="black"/></mask>
                <rect class="pieceRect" id="piece3" x="0" y="180" width="300" height="180" fill="#0b79d0" opacity="0.95"/>

                <mask id="m4"><rect width="600" height="360" fill="white"/><rect x="300" y="180" width="300" height="180" fill="black"/></mask>
                <rect class="pieceRect" id="piece4" x="300" y="180" width="300" height="180" fill="#0b79d0" opacity="0.95"/>
              </g>

              <!-- small guide text under image -->
              <text x="300" y="350" text-anchor="middle" font-size="14" fill="#034d73">(Ảnh gợi ý — sẽ dần lộ khi trả lời hàng ngang)</text>
            </svg>
          </div>

          <div class="hint-stage" style="margin-top:12px">
            <div class="hint-piece" id="hp1">Mảnh 1</div>
            <div class="hint-piece" id="hp2">Mảnh 2</div>
            <div class="hint-piece" id="hp3">Mảnh 3</div>
            <div class="hint-piece" id="hp4">Mảnh 4</div>
          </div>

          <div style="margin-top:10px" class="small">Mẹo: trả lời 1 hàng ngang đúng được +10 điểm; đoán từ khóa đúng được +60 điểm và kết thúc vòng.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit modal (simple) -->
  <div id="editModal" style="position:fixed;inset:0;background:rgba(10,10,20,.45);display:none;align-items:center;justify-content:center;padding:20px">
    <div style="background:white;padding:18px;border-radius:12px;max-width:720px;width:100%">
      <h3 style="margin-top:0">Chỉnh câu / Từ khóa</h3>
      <div style="display:grid;gap:8px">
        <label class="small">Từ khóa (đáp án cuối):</label>
        <input id="editKeyword" type="text" />

        <div id="editRows"></div>

        <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:8px">
          <button id="saveEdit">Lưu</button>
          <button id="cancelEdit">Hủy</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Default data (sample). You can edit via "Chỉnh câu".
    const defaultData = {
      keyword: 'OLYMPIA',
      rows: [
        {q:'Thủ đô của Việt Nam?', a:'Hà Nội'},
        {q:'Màu bầu trời thường thấy?', a:'Xanh'},
        {q:'Số chữ cái trong từ "OLYMPIA"?', a:'7'},
        {q:'Loài vật tượng trưng cho sức mạnh, thường xuất hiện trong logo thể thao?', a:'Sư tử'}
      ]
    }

    // Game state
    let data = JSON.parse(JSON.stringify(defaultData));
    let opened = [false,false,false,false];
    let score = 0;
    let finished = false;

    const questionsEl = document.getElementById('questions');
    const scoreEl = document.getElementById('score');
    const statusEl = document.getElementById('status');
    const logEl = document.getElementById('log');
    const piecesOpenEl = document.getElementById('piecesOpen');

    function log(txt){
      const time = new Date().toLocaleTimeString();
      logEl.innerHTML = `<div style="margin-bottom:6px"><strong>[${time}]</strong> ${txt}</div>` + logEl.innerHTML;
    }

    function renderQuestions(){
      questionsEl.innerHTML = '';
      data.rows.forEach((r,i)=>{
        const div = document.createElement('div');
        div.className = 'row';
        const q = document.createElement('div'); q.style.minWidth='44%'; q.style.fontWeight='600'; q.textContent = `Hàng ${i+1}: ${r.q}`;
        const inp = document.createElement('input'); inp.type='text'; inp.placeholder='Nhập đáp án...'; inp.id = 'ans'+i;
        const btn = document.createElement('button'); btn.textContent='Trả lời';
        btn.onclick = ()=> checkRow(i, inp.value.trim());
        if(opened[i]){ inp.disabled=true; btn.disabled=true }
        div.appendChild(q); div.appendChild(inp); div.appendChild(btn);
        questionsEl.appendChild(div);
      })
    }

    function updateScore(){ scoreEl.textContent = score }
    function updatePieces(){
      const count = opened.filter(Boolean).length; piecesOpenEl.textContent = `${count}/4`;
      for(let i=1;i<=4;i++){
        const rect = document.getElementById('piece'+i);
        const hp = document.getElementById('hp'+i);
        if(opened[i-1]){
          // hide overlay piece visually by transitioning opacity
          rect.style.transition = 'opacity .5s'; rect.style.opacity = 0;
          hp.classList.add('revealed'); hp.textContent = '';
        } else { rect.style.opacity = .95; hp.classList.remove('revealed'); hp.textContent = 'Mảnh '+i }
      }
    }

    function checkRow(index, answer){
      if(finished) return; answer = answer || '';
      if(!answer){ alert('Nhập đáp án trước khi trả lời.'); return }
      const correct = data.rows[index].a.trim().toLowerCase();
      if(answer.trim().toLowerCase() === correct){
        if(opened[index]){ alert('Hạng này đã trả lời đúng rồi.'); return }
        opened[index] = true;
        score += 10; updateScore(); updatePieces(); renderQuestions(); statusEl.textContent = `Mở mảnh ${index+1}`;
        log(`Trả lời đúng hàng ${index+1} — +10 điểm`);
        if(opened.every(Boolean)) statusEl.textContent = 'Đã mở hết gợi ý. Có thể đoán từ khóa.';
      } else {
        log(`Trả lời sai hàng ${index+1}: "${answer}"`);
        alert('Sai đáp án.');
      }
    }

    // Buzzer (guess keyword)
    document.getElementById('buzzBtn').addEventListener('click', ()=>{
      if(finished) { alert('Vòng đã kết thúc. Hãy reset để chơi lại.'); return }
      const guess = document.getElementById('buzzerInput').value.trim();
      if(!guess) { alert('Gõ 1 đáp án để đoán.'); return }
      if(guess.toLowerCase() === data.keyword.toLowerCase()){
        score += 60; updateScore(); finished = true; statusEl.textContent = 'Đoán đúng - Kết thúc vòng';
        log(`Đoán đúng từ khóa "${guess}" — +60 điểm. Vòng kết thúc.`);
        // reveal all
        opened = [true,true,true,true]; updatePieces(); renderQuestions();
        alert('Chúc mừng! Bạn đoán đúng từ khóa.');
      } else {
        log(`Đoán từ khóa sai: "${guess}"`);
        alert('Sai. Tiếp tục chơi.');
      }
    });

    // Reveal all button
    document.getElementById('revealAllBtn').addEventListener('click', ()=>{
      if(!confirm('Hiển thị tất cả mảnh gợi ý? (không thay đổi điểm)')) return;
      opened = [true,true,true,true]; updatePieces(); renderQuestions(); statusEl.textContent = 'Hiển thị tất cả'; log('Người chơi hiển thị tất cả mảnh gợi ý.');
    });

    // Reset
    document.getElementById('resetBtn').addEventListener('click', ()=>{
      if(!confirm('Reset trò chơi? Tất cả điểm và mảnh sẽ về ban đầu.')) return;
      data = JSON.parse(JSON.stringify(defaultData)); opened = [false,false,false,false]; score = 0; finished = false; updateScore(); updatePieces(); renderQuestions(); statusEl.textContent='Chưa bắt đầu'; log('Đã reset trò chơi.');
    });

    // Edit modal
    const editModal = document.getElementById('editModal');
    document.getElementById('editBtn').addEventListener('click', ()=>{
      document.getElementById('editKeyword').value = data.keyword;
      const editRows = document.getElementById('editRows'); editRows.innerHTML = '';
      data.rows.forEach((r,i)=>{
        const wrap = document.createElement('div'); wrap.style.display='grid'; wrap.style.gridTemplateColumns='1fr 160px'; wrap.style.gap='8px'; wrap.style.marginBottom='6px';
        const q = document.createElement('input'); q.value = r.q; q.id = 'e_q_'+i;
        const a = document.createElement('input'); a.value = r.a; a.id = 'e_a_'+i;
        wrap.appendChild(q); wrap.appendChild(a); editRows.appendChild(wrap);
      })
      editModal.style.display='flex';
    });
    document.getElementById('cancelEdit').addEventListener('click', ()=>{ editModal.style.display='none'; });
    document.getElementById('saveEdit').addEventListener('click', ()=>{
      const kw = document.getElementById('editKeyword').value.trim(); if(!kw){ alert('Từ khóa không được rỗng'); return }
      const newRows = [];
      for(let i=0;i<4;i++){ const q = document.getElementById('e_q_'+i).value.trim(); const a = document.getElementById('e_a_'+i).value.trim(); if(!q||!a){ alert('Các hàng phải có câu hỏi và đáp án'); return } newRows.push({q,a}); }
      data.keyword = kw; data.rows = newRows; editModal.style.display='none'; opened = [false,false,false,false]; finished=false; score=0; updateScore(); updatePieces(); renderQuestions(); statusEl.textContent='Đã cập nhật câu'; log('Cập nhật câu và từ khóa.');
    });

    // initialize
    renderQuestions(); updatePieces(); updateScore(); statusEl.textContent='Sẵn sàng';
  </script>
</body>
</html>
